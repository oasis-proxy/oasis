# 临时规则 (Temporary Rules)

临时规则是 Oasis 提供的一种**会话限定 (Session-only)** 的路由机制，允许在不修改持久策略的情况下快速调整特定请求的代理分配。

## 1. 核心特性

- **会话持久性**: 临时规则存储在浏览器的 `session` 存储中。这意味着当您完全关闭浏览器或结束当前会话时，这些规则会自动清除。
- **高优先级**: 临时规则的评估优先级高于常规策略规则（Normal Rules），但低于“拒绝规则 (Reject Rules)”。优先级可以在选项页的`通用配置` -> `优先级`中调整。
- **单向转化**: 您可以将测试有效的临时规则一键“转正”为当前自动策略的持久规则。

---

## 2. 规则创建

临时规则主要通过 **“快速添加 (Quick Add)”** 工作流生成：

1. 打开扩展 **Popup** 。
2. 切换至 **“Quick”** 标签页。
3. 在捕获的失败请求列表中选择需要代理的域名。
4. 在下方的“添加至 (Add To)”下拉菜单中选择 **“Temporary (Session)”**。
5. 点击 **Confirm**。

此时，选中的域名将立即应用选定的代理，并出现在侧边栏的“临时规则”列表中。

---

## 3. 管理与“转正”

在选项页侧边栏点击 **“临时规则 (Temporary Rules)”** 即可进入管理界面：

- **实时编辑**: 您可以在列表中修改临时规则的匹配模式（通配符/正则）、类型或目标代理，点击 **Save** 即可生效。
- **转正 (Accept)**: 点击规则行右侧的 **“打钩/接受”** 图标，该规则将从临时列表中移除，并永久添加至当前活跃的自动策略中。
- **全部接受 (Accept All)**: 点击卡片顶部工具栏的 **“双勾”** 图标，可将所有临时规则一次性存入持久策略。
- **智能合并 (Merge Rules)**: 点击卡片顶部的 **“合并”** 图标。该功能会触发智能合并引擎，在存入持久策略前对重复规则进行去重并自动收缩通配符（如将子域名合并为根域名图案）。
- **删除**: 点击“垃圾桶”图标删除单条临时规则。
- **清空**: 点击卡片顶部的“垃圾桶”图标可一次性清除所有会话规则。

---

## 4. 未保存更改保护 (Unsaved Changes)

Oasis 采用了严格的页面切换保护机制：

- **锁定状态**: 若当前页面存在未保存的修改，侧边栏导航将被锁定。
- **解除锁定**: 必须点击页面顶部的 **Save** 按钮保存更改，或点击 **Reset** 按钮放弃修改并恢复至最后一次保存的状态。
- **目的**: 确保用户不会意外丢失正在编辑的路由规则或代理配置。

---

## 5. 注意事项

- **前提条件**: 临时规则仅在当前活跃配置集（Profile）为**自动策略**时生效。如果当前切换到了“直接连接”、“系统代理”、“PAC”、“服务器”，临时规则将处于非活跃状态。
- **冲突处理**: 如果临时规则与持久规则存在冲突，系统将优先遵循临时规则的指示。

---

## 相关指南

- [自动策略 (Auto Policy)](AUTO_POLICY.md)
- [交互界面说明 (Popup & Sidepanel)](INTERACTIVE.md)
