# 代理节点与 PAC 配置

本指南详细介绍 Oasis 中可用的不同代理类型，以及实现最佳使用的配置选项。

## 1. 代理服务器 (单一节点)

单一服务器节点是 Oasis 的基本构建块。

### 连接详情

- **协议**: 支持 `HTTP`、`HTTPS`、`SOCKS4` 和 `SOCKS5`。
- **地址与端口**: 支持标准主机地址（域名或 IP）和端口号。默认端口提供智能占位符（例如：HTTP 为 8080，SOCKS 为 1080，HTTPS 为 443）。

### 身份验证设置

- 所有协议类型均支持标准 **用户名** 和 **密码** 身份验证。
- 留空则不应用身份验证。

### 高级协议覆盖

> [!IMPORTANT]
> 此功能用于管理复杂的网络环境，在这些环境中，即使在单个逻辑“代理服务器”内，不同协议（HTTP、HTTPS、FTP）也需要特定的代理节点或设置。

- 支持为 **HTTP**、**HTTPS** 和 **FTP** 流量定义特定的覆盖配置。
- 每个覆盖选项允许指定完全不同的协议、主机、端口和身份验证。
- 设置为 `Default` 则使用主要连接详情。

### 绕过规则

- 匹配这些模式的请求将绕过代理并直接连接。
- 支持 **通配符** (例如：`*.local`, `localhost`) 和 **IP/CIDR** 范围。具体参考链接 [绕过规则编写指南](https://developer.chrome.com/docs/extensions/reference/api/proxy#bypass_list)

### 管理功能

- **重命名与克隆**: 支持复制现有节点以进行少量参数修改。
- **颜色图标**: 可为节点分配自定义颜色，以便在监控和弹出页面 UI 中进行即时识别。
- **弹出页面控制**: 通过“在弹出页面显示”开关，可快速访问常用节点并隐藏其他节点。

---

## 2. 代理组 (多个代理服务器的fallback集合)

代理组支持将多个代理服务器分组到一个定义了优先级的fallback集合中。

### 故障转移链管理

- 可向组中添加多个节点。
- 通过 **拖放** 重新排序来确定连接优先级。
- 自动化回退逻辑：若第一个节点失败，自动切换到列表中的下一个节点。

### 终止策略

> [!TIP]
> 终止策略决定了当组中 _所有_ 节点都不可达时的处理行为。

- **直接连接 (Direct)**: 所有节点失效时，不使用代理进行连接。
- **拒绝 (Reject)**: 所有节点失效时，完全阻止请求，以增强安全性和隐私。

---

## 3. PAC 脚本 (JavaScript 逻辑)

对于高级路由需求，Oasis 支持完全可自定义的基于 JavaScript 的代理自动配置 (PAC)。

### 手动脚本编辑

- 集成编辑器支持 **语法高亮**，用于编写 `FindProxyForURL(url, host)` 逻辑。
- 此模式适用于超出标准通配符能力的复杂条件路由。

### 远程 URL 订阅

- 支持订阅托管在远程服务器上的 PAC 脚本。
- **自动获取**: 定期检索脚本的最新版本。
- **本地缓存**: 脚本在本地缓存，确保在远程服务器暂时关闭时仍能正常工作。
- **更新间隔**: 可配置检查更新的频率（例如：每 1 小时、每 24 小时）。

### 管理功能

- **重命名与克隆**: 支持复制现有节点以进行少量参数修改。
- **颜色图标**: 可为节点分配自定义颜色，以便在监控和弹出页面 UI 中进行即时识别。
- **弹出页面控制**: 通过“在弹出页面显示”开关，可快速访问常用节点并隐藏其他节点。

---

---

## 4. 未保存更改保护 (Unsaved Changes)

在代理服务器、代理组和 PAC 脚本的详情编辑页面中，Oasis 启用了严格的导航保护：

- **锁定状态**: 若当前配置项已发生修改（包括名称、地址、端口、脚本内容或颜色等）且尚未保存，侧边栏的所有跳转链接将被锁定。
- **解除锁定**: 必须点击页面顶部的 **Save** 按钮以保存配置，或点击 **Reset** 按钮还原修改。
- **目的**: 避免用户在复杂的代理参数配置过程中因误触侧边栏而丢失尚未保存的数据。

---

## 技术参考

- [自动策略配置](AUTO_POLICY.md)
- [请求监控页面](MONITORING.md)
- [扩展配置](EXTENSION_CONFIG.md)
